<!doctype html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name="hugo-theme" content="Axiom 0.8.0">



  <link rel="icon" type="image/png" sizes="32x32" href="/">
  <link rel="icon" type="image/x-icon" href="/">
  <link rel="apple-touch-icon" href="/">
  <link rel="canonical" href="https://rtichoke.netlify.app/post/bayesian_optimisation_xgboost/">
<link rel="preload" as="style" href="/bundle.css?v=1680150811" media="all">
<link rel="stylesheet" href="/bundle.css?v=1680150811" media="all">
<style>.cdata pre{background-color:#1f2937;color:#e5e7eb}.cdata :not(pre)>code{background-color:#f3f4f6;color:#7c3aed}.chroma .err{background-color:#991b1b;color:#fecaca}.chroma .hl{background-color:#374151}.chroma .ln{color:#9ca3af}.chroma .k,.chroma .kc,.chroma .kd,.chroma .kn,.chroma .kp,.chroma .kr{color:#60a5fa}.chroma .kt{color:#a78bfa}.chroma .na,.chroma .nb{color:#fbbf24}.chroma .nc{color:#f87171}.chroma .no{color:#34d399}.chroma .nd{color:#f87171}.chroma .ne{color:#f87171}.chroma .nf{color:#fbbf24}.chroma .nt{color:#f87171}.chroma .l{color:#a78bfa}.chroma .dl,.chroma .ld,.chroma .s,.chroma .s2,.chroma .sa,.chroma .sb,.chroma .sc,.chroma .sd{color:#34d399}.chroma .se{color:#9ca3af}.chroma .s1,.chroma .sh,.chroma .si,.chroma .sr,.chroma .ss,.chroma .sx{color:#34d399}.chroma .il,.chroma .m,.chroma .mb,.chroma .mf,.chroma .mh,.chroma .mi,.chroma .mo{color:#a78bfa}.chroma .o,.chroma .ow{color:#93c5fd}.chroma .c,.chroma .c1,.chroma .ch,.chroma .cm,.chroma .cp,.chroma .cpf,.chroma .cs,.chroma .p{color:#9ca3af}.chroma .ge{font-style:italic}.chroma .gs{font-weight:700}
</style>



<title>Using bayesian optimisation to tune a XGBOOST model in R : R&#39;tichoke</title>

<meta property="og:title" content="Using bayesian optimisation to tune a XGBOOST model in R">
<meta property="og:site_name" content="R&#39;tichoke">
<meta property="og:url" content="https://rtichoke.netlify.app/post/bayesian_optimisation_xgboost/">
<link rel="image_src" href="https://rtichoke.netlify.app/">
<meta property="og:image" content="https://rtichoke.netlify.app/">
<meta property="og:image:width" content="">
<meta property="og:image:height" content="">
<meta property="og:type" content="article">
<meta property="og:locale" content="en_us">
<meta property="og:description" content="How to use bayesian optimisation to tune hyperparameters in a XGBOOST model in R">
<meta name="description" content="How to use bayesian optimisation to tune hyperparameters in a XGBOOST model in R">
<meta property="og:updated_time" content="2022-01-08T00:00:00Z">
<meta property="fb:app_id" content="">
<meta name="author" content="Riddhiman">
<meta property="article:author" content="https://linkedin.com/in/riddhimanr">
<meta property="article:published_time" content="2022-01-08T00:00:00Z">
<meta property="article:modified_time" content="2022-01-08T00:00:00Z">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Using bayesian optimisation to tune a XGBOOST model in R",
  "alternativeHeadline": "ML series (Post #1)",
  "url": "https://rtichoke.netlify.app/post/bayesian_optimisation_xgboost/",
  "image": "https://rtichoke.netlify.app/",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://rtichoke.netlify.app/post/bayesian_optimisation_xgboost/"
  },
  "description": "How to use bayesian optimisation to tune hyperparameters in a XGBOOST model in R",
  "author": {
    "@type": "Person",
    "name": "Riddhiman"
  },
  "publisher": {
    "@type": "Organization",
    "name": "R'tichoke",
    "logo": {
      "@type": "ImageObject",
      "url": "https://rtichoke.netlify.app/"
    }
  },
  "datePublished": "2022-01-08T00:00:00Z",
  "dateModified": "2022-01-08T00:00:00Z",
  "articleBody": "\u003cp\u003eMy first post in 2022! A very happy new year to anyone reading this. Ыu003c/p\u003e\n\u003cp\u003eI was looking for a simple and effective way to tune \u003ccode\u003exgboost\u003c/code\u003e models in \u003ccode\u003eR\u003c/code\u003e and came across this package called \u003ca href=\"https://github.com/AnotherSamWilson/ParBayesianOptimization\"\u003eParBayesianOptimization\u003c/a\u003e. Here\u0026rsquo;s a quick tutorial on how to use it to tune a \u003ccode\u003exgboost\u003c/code\u003e model.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Pacman is a package management tool \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003einstall.packages\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;pacman\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(pacman)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# p_load automatically installs packages if needed\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ep_load\u003c/span\u003e(xgboost, ParBayesianOptimization, mlbench, dplyr, skimr, recipes, resample)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"data-prep\"\u003eData prep\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Load up some data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;BostonHousing2\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Data summary\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eskim\u003c/span\u003e(BostonHousing2)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eTable: Table 1: Data summary\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003e\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003e\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eName\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eBostonHousing2\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eNumber of rows\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e506\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eNumber of columns\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e19\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e_______________________\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eColumn type frequency:\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003efactor\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e2\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003enumeric\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e17\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e________________________\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eGroup variables\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eNone\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003eVariable type: factor\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003eskim_variable\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003en_missing\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003ecomplete_rate\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eordered\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003en_unique\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003etop_counts\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003etown\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eFALSE\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e92\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eCam: 30, Bos: 23, Lyn: 22, Bos: 19\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003echas\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eFALSE\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e2\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e0: 471, 1: 35\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003eVariable type: numeric\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003eskim_variable\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003en_missing\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003ecomplete_rate\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003emean\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003esd\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003ep0\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003ep25\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003ep50\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003ep75\u003c/th\u003e\n\u003cth style=\"text-align:right\"\u003ep100\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ehist\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003etract\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e2700.36\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1380.04\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1303.25\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e3393.50\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e3739.75\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e5082.00\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆笆や魔笆笆\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003elon\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e-71.06\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.08\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e-71.29\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e-71.09\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e-71.05\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e-71.02\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e-70.81\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆≫魔笆笆や磨\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003elat\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e42.22\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.06\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e42.03\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e42.18\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e42.22\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e42.25\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e42.38\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆≫麻笆笆笆―u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003emedv\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e22.53\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e9.20\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e5.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e17.02\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e21.20\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e25.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e50.00\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆や枚笆笆≫磨\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ecmedv\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e22.53\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e9.18\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e5.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e17.02\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e21.20\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e25.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e50.00\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆や枚笆笆≫磨\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ecrim\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e3.61\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e8.60\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.01\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.08\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.26\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e3.68\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e88.98\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆笆≫磨笆≫磨\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ezn\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e11.36\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e23.32\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e12.50\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e100.00\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆笆≫磨笆≫磨\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eindus\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e11.14\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e6.86\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.46\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e5.19\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e9.69\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e18.10\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e27.74\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆笆笆≫枚笆―u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003enox\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.55\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.12\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.38\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.45\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.54\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.62\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.87\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆笆笆笆笆―u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003erm\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e6.28\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.70\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e3.56\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e5.89\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e6.21\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e6.62\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e8.78\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆≫魔笆笆や磨\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eage\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e68.57\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e28.15\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e2.90\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e45.02\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e77.50\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e94.07\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e100.00\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆や魔笆や麻笆Ⅸu003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edis\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e3.80\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e2.11\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1.13\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e2.10\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e3.21\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e5.19\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e12.13\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆笆笆や磨笆―u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003erad\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e9.55\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e8.71\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e4.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e5.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e24.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e24.00\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆笆や磨笆≫麻\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003etax\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e408.24\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e168.54\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e187.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e279.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e330.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e666.00\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e711.00\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆笆笆笆≫枚\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eptratio\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e18.46\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e2.16\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e12.60\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e17.40\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e19.05\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e20.20\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e22.00\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆≫麻笆笆笆Ⅸu003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eb\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e356.67\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e91.29\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0.32\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e375.38\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e391.44\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e396.22\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e396.90\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆≫磨笆≫磨笆Ⅸu003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003elstat\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e12.65\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e7.14\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e1.73\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e6.95\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e11.36\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e16.96\u003c/td\u003e\n\u003ctd style=\"text-align:right\"\u003e37.97\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e笆笆笆笆や磨\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eLooks like there is are two factor variables. We\u0026rsquo;ll need to convert them into numeric variables before we proceed. I\u0026rsquo;ll use the \u003ccode\u003erecipes\u003c/code\u003e package to one-hot encode them.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Predicting median house prices\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erec \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erecipe\u003c/span\u003e(cmedv \u003cspan style=\"color:#f92672\"\u003e~\u003c/span\u003e ., data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e BostonHousing2) \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e# Collapse categories where population is \u0026lt; 3%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003estep_other\u003c/span\u003e(town, chas, threshold \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e.03\u003c/span\u003e, other \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Other\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e# Create dummy variables for all factor variables \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003estep_dummy\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eall_nominal_predictors\u003c/span\u003e())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Train the recipe on the data set\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprep \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eprep\u003c/span\u003e(rec, training \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e BostonHousing2)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Create the final model matrix\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emodel_df \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebake\u003c/span\u003e(prep, new_data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e BostonHousing2)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# All levels have been one hot encoded and separate columns have been appended to the model matrix\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ecolnames\u003c/span\u003e(model_df)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e##  [1] \u0026#34;tract\u0026#34;                  \u0026#34;lon\u0026#34;                    \u0026#34;lat\u0026#34;                   \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e##  [4] \u0026#34;medv\u0026#34;                   \u0026#34;crim\u0026#34;                   \u0026#34;zn\u0026#34;                    \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e##  [7] \u0026#34;indus\u0026#34;                  \u0026#34;nox\u0026#34;                    \u0026#34;rm\u0026#34;                    \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## [10] \u0026#34;age\u0026#34;                    \u0026#34;dis\u0026#34;                    \u0026#34;rad\u0026#34;                   \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## [13] \u0026#34;tax\u0026#34;                    \u0026#34;ptratio\u0026#34;                \u0026#34;b\u0026#34;                     \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## [16] \u0026#34;lstat\u0026#34;                  \u0026#34;cmedv\u0026#34;                  \u0026#34;town_Boston.Savin.Hill\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## [19] \u0026#34;town_Cambridge\u0026#34;         \u0026#34;town_Lynn\u0026#34;              \u0026#34;town_Newton\u0026#34;           \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## [22] \u0026#34;town_Other\u0026#34;             \u0026#34;chas_X1\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNext, we can use the \u003ccode\u003eresample\u003c/code\u003e package to create test/train splits.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esplits \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e rsample\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003einitial_split\u003c/span\u003e(model_df, prop \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0.7\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Training set\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etrain_df \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e rsample\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003etraining\u003c/span\u003e(splits)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Test set\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etest_df \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e rsample\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003etesting\u003c/span\u003e(splits)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edim\u003c/span\u003e(train_df)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## [1] 354  23\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edim\u003c/span\u003e(test_df)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## [1] 152  23\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"finding-optimal-parameters\"\u003eFinding optimal parameters\u003c/h2\u003e\n\u003cp\u003eNow we can start to run some optimisations using the \u003ccode\u003eParBayesianOptimization\u003c/code\u003e package.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# The xgboost interface accepts matrices \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eX \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e train_df \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e# Remove the target variable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eselect\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003emedv, \u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003ecmedv) \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eas.matrix\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Get the target variable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ey \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e train_df \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003epull\u003c/span\u003e(cmedv)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Cross validation folds\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003efolds \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(fold1 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eas.integer\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eseq\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003enrow\u003c/span\u003e(X), by \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e)),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              fold2 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eas.integer\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eseq\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003enrow\u003c/span\u003e(X), by \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e)))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe\u0026rsquo;ll need an objective function which can be fed to the optimiser. We\u0026rsquo;ll use the value of the evaluation metric from \u003ccode\u003exgb.cv()\u003c/code\u003e as the value that needs to be optimised.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Function must take the hyper-parameters as inputs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eobj_func \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efunction\u003c/span\u003e(eta, max_depth, min_child_weight, subsample, lambda, alpha) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  param \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Hyter parameters \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    eta \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e eta,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    max_depth \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e max_depth,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    min_child_weight \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e min_child_weight,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    subsample \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e subsample,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    lambda \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e lambda,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    alpha \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e alpha,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Tree model \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    booster \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;gbtree\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Regression problem \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    objective \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;reg:squarederror\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Use the Mean Absolute Percentage Error\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    eval_metric \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mape\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  xgbcv \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003exgb.cv\u003c/span\u003e(params \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e param,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e X,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  label \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e y,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  nround \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  folds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e folds,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  prediction \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  early_stopping_rounds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  verbose \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  maximize \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e F)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  lst \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# First argument must be named as \u0026#34;Score\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Function finds maxima so inverting the output\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Score \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003emin\u003c/span\u003e(xgbcv\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eevaluation_log\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003etest_mape_mean),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Get number of trees for the best performing model\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    nrounds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e xgbcv\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ebest_iteration\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  )\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003ereturn\u003c/span\u003e(lst)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOnce we have the objective function, we\u0026rsquo;ll need to define some bounds for the optimiser to search within.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebounds \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(eta \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0.001\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0.2\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               max_depth \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1L\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10L\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               min_child_weight \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               subsample \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0.1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               lambda \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               alpha \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe can now run the optimiser to find a set of optimal hyper-parameters.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eset.seed\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1234\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebayes_out \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebayesOpt\u003c/span\u003e(FUN \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e obj_func, bounds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bounds, initPoints \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elength\u003c/span\u003e(bounds) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, iters.n \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Show relevant columns from the summary object \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebayes_out\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003escoreSummary[1\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e)]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e##           eta max_depth min_child_weight subsample   lambda    alpha      Score\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## 1: 0.13392137         8         4.913332 0.2105925 4.721124 3.887629 -0.0902970\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## 2: 0.19400811         2        25.454160 0.9594105 9.329695 3.173695 -0.1402720\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## 3: 0.16079775         2        14.035652 0.5118349 1.229953 5.093530 -0.1475580\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## 4: 0.08957707         4        12.534842 0.3844404 4.358837 1.788342 -0.1410245\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## 5: 0.02876388         4        36.586761 0.8107181 6.137100 6.039125 -0.3061535\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Get best parameters\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edata.frame\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003egetBestPars\u003c/span\u003e(bayes_out))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e##         eta max_depth min_child_weight subsample lambda alpha\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## 1 0.1905414         8         1.541476 0.8729207      1     1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"fitting-the-model\"\u003eFitting the model\u003c/h2\u003e\n\u003cp\u003eWe can now fit a model and check how well these parameters work.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Combine best params with base params\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eopt_params \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eappend\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(booster \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;gbtree\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                          objective \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;reg:squarederror\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                          eval_metric \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mae\u0026#34;\u003c/span\u003e), \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                     \u003cspan style=\"color:#a6e22e\"\u003egetBestPars\u003c/span\u003e(bayes_out))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Run cross validation \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003exgbcv \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003exgb.cv\u003c/span\u003e(params \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e opt_params,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e X,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                label \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e y,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                nround \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                folds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e folds,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                prediction \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                early_stopping_rounds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                verbose \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                maximize \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e F)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Get optimal number of rounds\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enrounds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e xgbcv\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ebest_iteration\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Fit a xgb model\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emdl \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003exgboost\u003c/span\u003e(data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e X, label \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e y, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               params \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e opt_params, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               maximize \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e F, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               early_stopping_rounds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               nrounds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e nrounds, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               verbose \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Evaluate performance \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eactuals \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e test_df\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ecmedv\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epredicted \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e test_df \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eselect_at\u003c/span\u003e(mdl\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003efeature_names) \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  as.matrix \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003epredict\u003c/span\u003e(mdl, newdata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e .)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Compute MAPE\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emean\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eabs\u003c/span\u003e(actuals \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e predicted)\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003eactuals)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## [1] 0.009401109\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"compare-with-grid-search\"\u003eCompare with grid search\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egrd \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eexpand.grid\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  eta \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eseq\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0.001\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0.2\u003c/span\u003e, length.out \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  max_depth \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eseq\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e2L\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10L\u003c/span\u003e, by \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  min_child_weight \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eseq\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e25\u003c/span\u003e, length.out \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  subsample \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0.25\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0.5\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0.75\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  lambda \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  alpha \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edim\u003c/span\u003e(grd)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egrd_out \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eapply\u003c/span\u003e(grd, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003efunction\u003c/span\u003e(par){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    par \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eappend\u003c/span\u003e(par, \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(booster \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;gbtree\u0026#34;\u003c/span\u003e,objective \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;reg:squarederror\u0026#34;\u003c/span\u003e,eval_metric \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mae\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    mdl \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003exgboost\u003c/span\u003e(data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e X, label \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e y, params \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e par, nrounds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e, early_stopping_rounds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e, maximize \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e F, verbose \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    lst \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata.frame\u003c/span\u003e(par, score \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e mdl\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ebest_score)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ereturn\u003c/span\u003e(lst)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  })\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egrd_out \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edo.call\u003c/span\u003e(rbind, grd_out)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebest_par \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e grd_out \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003edata.frame\u003c/span\u003e() \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003earrange\u003c/span\u003e(score) \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  .[1,]\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Fit final model\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eparams \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eas.list\u003c/span\u003e(best_par[\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003elength\u003c/span\u003e(best_par)])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003exgbcv \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003exgb.cv\u003c/span\u003e(params \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e params,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e X,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                label \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e y,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                nround \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                folds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e folds,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                prediction \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                early_stopping_rounds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                verbose \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                maximize \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e F)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enrounds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e xgbcv\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ebest_iteration\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emdl \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003exgboost\u003c/span\u003e(data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e X, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               label \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e y, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               params \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e params, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               maximize \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e F, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               early_stopping_rounds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               nrounds \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e nrounds, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               verbose \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Evaluate on test set\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eact \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e test_df\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003emedv\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epred \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e test_df \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eselect_at\u003c/span\u003e(mdl\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003efeature_names) \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  as.matrix \u003cspan style=\"color:#f92672\"\u003e%\u0026gt;%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003epredict\u003c/span\u003e(mdl, newdata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e .)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emean\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eabs\u003c/span\u003e(act \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e pred)\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003eact)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## [1] 0.01581713\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWhile both the methods offer similar final results, the bayesian optimiser completed its search in less than a minute where as the grid search took over seven minutes. Also, I find that I can use bayesian optimisation to search a larger parameter space more quickly than a traditional grid search.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eThoughts? Comments? Helpful? Not helpful? Like to see anything else added in here? Let me know!\u003c/em\u003e\u003c/p\u003e"
}
</script>

<link rel="preload" as="script" href="/bundle.js?v=1680150811">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://stats.g.doubleclick.net">
<link rel="preconnect" href="https://www.googleadservices.com">
<link rel="preload" as="script" href="https://www.googletagmanager.com/gtag/js?id=UA-57026003-1">
<script src="https://www.googletagmanager.com/gtag/js?id=UA-57026003-1"></script>
<script>
  window.dataLayer=window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js',new Date());
  gtag('config','UA-57026003-1');
</script>

</head>
<body>

  <header id="nav" class="header">
  <div class="ax-l-i max-w-6xl">
    <div class="ax-logo">
      <a class="block" href="/" title="R&#39;tichoke"><span class="font-semibold text-raven-900">R'tichoke</span></a>
    </div>
    <div class="ax-user">
      <a class="p-2 w-8 h-8 block text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" target="_blank" rel="noopener nofollow" href="https://www.google.com/search?q=site:https://rtichoke.netlify.app/" title="Search">
        <svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.67 12.804c0-5.6 4.544-10.134 10.133-10.134s10.134 4.544 10.134 10.134-4.544 10.133-10.134 10.133S2.67 18.393 2.67 12.804zm28.943 16.923l-8.868-8.868c4.287-5.3 3.68-13.012-1.378-17.57S8.564-1.066 3.75 3.75s-5.017 12.558-.46 17.618 12.28 5.665 17.57 1.378l8.868 8.868a1.33 1.33 0 0 0 2.231-.597c.123-.46-.008-.952-.345-1.29h0z"/></svg>

      </a>
      <a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href="/post/">
        All Posts
      </a>
      <a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href="/about/">
        About
      </a>
      <a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href="/rbloggers/">
        R-Bloggers
      </a>
    </div>
  </div>

  
  
</header>


  <main>
<div class="default-single">
  <div class="ax-title ax-l-o">
    <div class="ax-l-i max-w-4xl">
      <h1 class="post-title font-content-title font-normal leading-tight tracking-default text-40">Using bayesian optimisation to tune a XGBOOST model in R</h1>
      <p class="post-subtitle font-content-sans font-light text-xl text-raven-500 mt-3">ML series (Post #1)</p>

      <div class="ax-meta flex items-center mt-5">
        <div class="flex-grow min-w-0">
          <div class="flex items-center">
  
  <div class="flex-shrink-0">
    <img
    class="w-12 h-12 sm:w-14 sm:h-14 object-cover p-3px rounded-full border border-blue-300"
    src="data:image/svg&#43;xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMzIgMzIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI&#43;PHBhdGggZmlsbD0iI2VjZWZmMSIgZD0iTTAgMGgzMnYzMkgweiIvPjxwYXRoIGZpbGw9IiM0NTVhNjQiIGQ9Ik0yOS4zMDUgMjQuNDA3Yy0uNzk1LS42My0xLjc2NS0xLjA4LTIuODE2LTEuM0wyMS40NzYgMjIuMWExLjEzIDEuMTMgMCAwIDEtLjkwNS0xLjEydi0xLjE1Yy4zMjItLjQ1My42MjYtMS4wNTQuOTQ0LTEuNjgyLjI0Ny0uNDg3LjYyLTEuMjIuODA1LTEuNCAxLjAxNS0xLjAyIDEuOTk1LTIuMTY1IDIuMy0zLjY0LjI4My0xLjM4NS4wMDUtMi4xMTItLjMyMi0yLjY5NyAwLTEuNDYtLjA0Ni0zLjI5LS4zOS00LjYyLS4wNC0xLjgtLjM2OC0yLjgxNC0xLjE5LTMuNy0uNTgtLjYzLTEuNDM1LS43NzUtMi4xMjMtLjg5LS4yNy0uMDQ2LS42NDItLjEtLjc4LS4xODNDMTguNTk0LjM0NyAxNy40LjAyNSAxNS45NTIgMGMtMyAuMTIzLTYuNzEgMi4wNC03Ljk1IDUuNDU0LS4zODQgMS4wNC0uMzQ1IDIuNzQ3LS4zMTMgNC4xMmwtLjAzLjgyNWMtLjI5NS41NzYtLjU4NSAxLjMwNy0uMyAyLjY5Ny4zMDIgMS40OCAxLjI4MiAyLjYyNiAyLjMxNSAzLjY2LjE3LjE3NC41NS45MTQuODAyIDEuNDAzbC45NSAxLjY3NXYxLjE1YzAgLjU0Ni0uMzgyIDEuMDE3LS45IDEuMTJMNS41IDIzLjExYy0xLjA0NS4yMjItMi4wMTQuNjctMi44MDcgMS4yOThhMS4xNSAxLjE1IDAgMCAwLS40MjcuODA1IDEuMTQgMS4xNCAwIDAgMCAuMjkzLjg1OUM1Ljk3NSAyOS44MzggMTAuODczIDMyIDE2IDMyczEwLjAyNy0yLjE2IDEzLjQ0LTUuOTNhMS4xNCAxLjE0IDAgMCAwLS4xMzUtMS42NjR6Ii8&#43;PC9zdmc&#43;DQo="
    alt="">
	</div>
    
  <div class="flex-shrink-0 ml-2 leading-tight font-content-sans">
    <a class="block text-sm text-raven-800 hover:text-raven-900 hover:underline focus:underline" target="_blank" rel="noopener nofollow" title="Riddhiman" href="https://linkedin.com/in/riddhimanr">Riddhiman</a>
    <time class="text-sm text-raven-500" datetime="2022-01-08T00:00:00Z">Jan 8, 2022</time>
  </div>
</div>

        </div>
        <div>
          

<div class="flex items-center">
    <a class="flex-shrink-0 block text-raven-800 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Share on Twitter" href="https://twitter.com/intent/tweet?text=Using%20bayesian%20optimisation%20to%20tune%20a%20XGBOOST%20model%20in%20R%20by%20%40%25%21s%28%3cnil%3e%29%20https%3a%2f%2frtichoke.netlify.app%2fpost%2fbayesian_optimisation_xgboost%2f"><svg class="w-6 h-6 fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11 0 0 1-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56 0 0 0-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57 0 0 0 2.914 5.452 6.48 6.48 0 0 1-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42 0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57a13.18 13.18 0 0 1-8.134 2.798c-.538 0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072 0 18.672-10 18.672-18.668 0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg>
</a>
    <a class="ml-3 flex-shrink-0 block text-raven-800 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Share on Facebook" href="https://www.facebook.com/dialog/share?app_id=&display=page&href=https%3a%2f%2frtichoke.netlify.app%2fpost%2fbayesian_optimisation_xgboost%2f"><svg class="w-6 h-6 fill-current" viewBox="-7 -3.5 39 39" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M30.234 0H1.765C.8.001 0 .79 0 1.766v28.47C.001 31.2.79 32 1.766 32h15.328V19.625h-4.156V14.78h4.156v-3.564c0-4.134 2.523-6.384 6.21-6.384 1.766 0 3.284.13 3.726.2v4.32h-2.543c-2.006 0-2.394.953-2.394 2.352v3.085h4.797l-.625 4.844h-4.172V32h8.14C31.21 32 32 31.2 32 30.234V1.765C32 .8 31.21 0 30.234 0z"/></svg>
</a>
  
</div>
        </div>
      </div>
    </div>
  </div><div class="ax-content ax-l-o">
    <div class="ax-l-i max-w-4xl">
      <article class="cdata">
<p>My first post in 2022! A very happy new year to anyone reading this. </p>
<p>I was looking for a simple and effective way to tune <code>xgboost</code> models in <code>R</code> and came across this package called <a href="https://github.com/AnotherSamWilson/ParBayesianOptimization">ParBayesianOptimization</a>. Here&rsquo;s a quick tutorial on how to use it to tune a <code>xgboost</code> model.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Pacman is a package management tool </span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;pacman&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(pacman)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># p_load automatically installs packages if needed</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">p_load</span>(xgboost, ParBayesianOptimization, mlbench, dplyr, skimr, recipes, resample)
</span></span></code></pre></div><h2 id="data-prep">Data prep</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Load up some data</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">data</span>(<span style="color:#e6db74">&#34;BostonHousing2&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Data summary</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">skim</span>(BostonHousing2)
</span></span></code></pre></div><p>Table: Table 1: Data summary</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Name</td>
<td style="text-align:left">BostonHousing2</td>
</tr>
<tr>
<td style="text-align:left">Number of rows</td>
<td style="text-align:left">506</td>
</tr>
<tr>
<td style="text-align:left">Number of columns</td>
<td style="text-align:left">19</td>
</tr>
<tr>
<td style="text-align:left">_______________________</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Column type frequency:</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">factor</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">numeric</td>
<td style="text-align:left">17</td>
</tr>
<tr>
<td style="text-align:left">________________________</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Group variables</td>
<td style="text-align:left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">skim_variable</th>
<th style="text-align:right">n_missing</th>
<th style="text-align:right">complete_rate</th>
<th style="text-align:left">ordered</th>
<th style="text-align:right">n_unique</th>
<th style="text-align:left">top_counts</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">town</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:left">FALSE</td>
<td style="text-align:right">92</td>
<td style="text-align:left">Cam: 30, Bos: 23, Lyn: 22, Bos: 19</td>
</tr>
<tr>
<td style="text-align:left">chas</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:left">FALSE</td>
<td style="text-align:right">2</td>
<td style="text-align:left">0: 471, 1: 35</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">skim_variable</th>
<th style="text-align:right">n_missing</th>
<th style="text-align:right">complete_rate</th>
<th style="text-align:right">mean</th>
<th style="text-align:right">sd</th>
<th style="text-align:right">p0</th>
<th style="text-align:right">p25</th>
<th style="text-align:right">p50</th>
<th style="text-align:right">p75</th>
<th style="text-align:right">p100</th>
<th style="text-align:left">hist</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">tract</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2700.36</td>
<td style="text-align:right">1380.04</td>
<td style="text-align:right">1.00</td>
<td style="text-align:right">1303.25</td>
<td style="text-align:right">3393.50</td>
<td style="text-align:right">3739.75</td>
<td style="text-align:right">5082.00</td>
<td style="text-align:left">笆笆や魔笆笆</td>
</tr>
<tr>
<td style="text-align:left">lon</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">-71.06</td>
<td style="text-align:right">0.08</td>
<td style="text-align:right">-71.29</td>
<td style="text-align:right">-71.09</td>
<td style="text-align:right">-71.05</td>
<td style="text-align:right">-71.02</td>
<td style="text-align:right">-70.81</td>
<td style="text-align:left">笆≫魔笆笆や磨</td>
</tr>
<tr>
<td style="text-align:left">lat</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">42.22</td>
<td style="text-align:right">0.06</td>
<td style="text-align:right">42.03</td>
<td style="text-align:right">42.18</td>
<td style="text-align:right">42.22</td>
<td style="text-align:right">42.25</td>
<td style="text-align:right">42.38</td>
<td style="text-align:left">笆≫麻笆笆笆</td>
</tr>
<tr>
<td style="text-align:left">medv</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">22.53</td>
<td style="text-align:right">9.20</td>
<td style="text-align:right">5.00</td>
<td style="text-align:right">17.02</td>
<td style="text-align:right">21.20</td>
<td style="text-align:right">25.00</td>
<td style="text-align:right">50.00</td>
<td style="text-align:left">笆や枚笆笆≫磨</td>
</tr>
<tr>
<td style="text-align:left">cmedv</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">22.53</td>
<td style="text-align:right">9.18</td>
<td style="text-align:right">5.00</td>
<td style="text-align:right">17.02</td>
<td style="text-align:right">21.20</td>
<td style="text-align:right">25.00</td>
<td style="text-align:right">50.00</td>
<td style="text-align:left">笆や枚笆笆≫磨</td>
</tr>
<tr>
<td style="text-align:left">crim</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3.61</td>
<td style="text-align:right">8.60</td>
<td style="text-align:right">0.01</td>
<td style="text-align:right">0.08</td>
<td style="text-align:right">0.26</td>
<td style="text-align:right">3.68</td>
<td style="text-align:right">88.98</td>
<td style="text-align:left">笆笆≫磨笆≫磨</td>
</tr>
<tr>
<td style="text-align:left">zn</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11.36</td>
<td style="text-align:right">23.32</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">12.50</td>
<td style="text-align:right">100.00</td>
<td style="text-align:left">笆笆≫磨笆≫磨</td>
</tr>
<tr>
<td style="text-align:left">indus</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11.14</td>
<td style="text-align:right">6.86</td>
<td style="text-align:right">0.46</td>
<td style="text-align:right">5.19</td>
<td style="text-align:right">9.69</td>
<td style="text-align:right">18.10</td>
<td style="text-align:right">27.74</td>
<td style="text-align:left">笆笆笆≫枚笆</td>
</tr>
<tr>
<td style="text-align:left">nox</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0.55</td>
<td style="text-align:right">0.12</td>
<td style="text-align:right">0.38</td>
<td style="text-align:right">0.45</td>
<td style="text-align:right">0.54</td>
<td style="text-align:right">0.62</td>
<td style="text-align:right">0.87</td>
<td style="text-align:left">笆笆笆笆笆</td>
</tr>
<tr>
<td style="text-align:left">rm</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">6.28</td>
<td style="text-align:right">0.70</td>
<td style="text-align:right">3.56</td>
<td style="text-align:right">5.89</td>
<td style="text-align:right">6.21</td>
<td style="text-align:right">6.62</td>
<td style="text-align:right">8.78</td>
<td style="text-align:left">笆≫魔笆笆や磨</td>
</tr>
<tr>
<td style="text-align:left">age</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">68.57</td>
<td style="text-align:right">28.15</td>
<td style="text-align:right">2.90</td>
<td style="text-align:right">45.02</td>
<td style="text-align:right">77.50</td>
<td style="text-align:right">94.07</td>
<td style="text-align:right">100.00</td>
<td style="text-align:left">笆や魔笆や麻笆</td>
</tr>
<tr>
<td style="text-align:left">dis</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3.80</td>
<td style="text-align:right">2.11</td>
<td style="text-align:right">1.13</td>
<td style="text-align:right">2.10</td>
<td style="text-align:right">3.21</td>
<td style="text-align:right">5.19</td>
<td style="text-align:right">12.13</td>
<td style="text-align:left">笆笆笆や磨笆</td>
</tr>
<tr>
<td style="text-align:left">rad</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">9.55</td>
<td style="text-align:right">8.71</td>
<td style="text-align:right">1.00</td>
<td style="text-align:right">4.00</td>
<td style="text-align:right">5.00</td>
<td style="text-align:right">24.00</td>
<td style="text-align:right">24.00</td>
<td style="text-align:left">笆笆や磨笆≫麻</td>
</tr>
<tr>
<td style="text-align:left">tax</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">408.24</td>
<td style="text-align:right">168.54</td>
<td style="text-align:right">187.00</td>
<td style="text-align:right">279.00</td>
<td style="text-align:right">330.00</td>
<td style="text-align:right">666.00</td>
<td style="text-align:right">711.00</td>
<td style="text-align:left">笆笆笆笆≫枚</td>
</tr>
<tr>
<td style="text-align:left">ptratio</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">18.46</td>
<td style="text-align:right">2.16</td>
<td style="text-align:right">12.60</td>
<td style="text-align:right">17.40</td>
<td style="text-align:right">19.05</td>
<td style="text-align:right">20.20</td>
<td style="text-align:right">22.00</td>
<td style="text-align:left">笆≫麻笆笆笆</td>
</tr>
<tr>
<td style="text-align:left">b</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">356.67</td>
<td style="text-align:right">91.29</td>
<td style="text-align:right">0.32</td>
<td style="text-align:right">375.38</td>
<td style="text-align:right">391.44</td>
<td style="text-align:right">396.22</td>
<td style="text-align:right">396.90</td>
<td style="text-align:left">笆≫磨笆≫磨笆</td>
</tr>
<tr>
<td style="text-align:left">lstat</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">12.65</td>
<td style="text-align:right">7.14</td>
<td style="text-align:right">1.73</td>
<td style="text-align:right">6.95</td>
<td style="text-align:right">11.36</td>
<td style="text-align:right">16.96</td>
<td style="text-align:right">37.97</td>
<td style="text-align:left">笆笆笆笆や磨</td>
</tr>
</tbody>
</table>
<p>Looks like there is are two factor variables. We&rsquo;ll need to convert them into numeric variables before we proceed. I&rsquo;ll use the <code>recipes</code> package to one-hot encode them.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Predicting median house prices</span>
</span></span><span style="display:flex;"><span>rec <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">recipe</span>(cmedv <span style="color:#f92672">~</span> ., data <span style="color:#f92672">=</span> BostonHousing2) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Collapse categories where population is &lt; 3%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">step_other</span>(town, chas, threshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">.03</span>, other <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Other&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Create dummy variables for all factor variables </span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">step_dummy</span>(<span style="color:#a6e22e">all_nominal_predictors</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Train the recipe on the data set</span>
</span></span><span style="display:flex;"><span>prep <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">prep</span>(rec, training <span style="color:#f92672">=</span> BostonHousing2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create the final model matrix</span>
</span></span><span style="display:flex;"><span>model_df <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">bake</span>(prep, new_data <span style="color:#f92672">=</span> BostonHousing2)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># All levels have been one hot encoded and separate columns have been appended to the model matrix</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">colnames</span>(model_df)
</span></span><span style="display:flex;"><span><span style="color:#75715e">##  [1] &#34;tract&#34;                  &#34;lon&#34;                    &#34;lat&#34;                   </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##  [4] &#34;medv&#34;                   &#34;crim&#34;                   &#34;zn&#34;                    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##  [7] &#34;indus&#34;                  &#34;nox&#34;                    &#34;rm&#34;                    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## [10] &#34;age&#34;                    &#34;dis&#34;                    &#34;rad&#34;                   </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## [13] &#34;tax&#34;                    &#34;ptratio&#34;                &#34;b&#34;                     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## [16] &#34;lstat&#34;                  &#34;cmedv&#34;                  &#34;town_Boston.Savin.Hill&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## [19] &#34;town_Cambridge&#34;         &#34;town_Lynn&#34;              &#34;town_Newton&#34;           </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## [22] &#34;town_Other&#34;             &#34;chas_X1&#34;</span>
</span></span></code></pre></div><p>Next, we can use the <code>resample</code> package to create test/train splits.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>splits <span style="color:#f92672">&lt;-</span> rsample<span style="color:#f92672">::</span><span style="color:#a6e22e">initial_split</span>(model_df, prop <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.7</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Training set</span>
</span></span><span style="display:flex;"><span>train_df <span style="color:#f92672">&lt;-</span> rsample<span style="color:#f92672">::</span><span style="color:#a6e22e">training</span>(splits)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Test set</span>
</span></span><span style="display:flex;"><span>test_df <span style="color:#f92672">&lt;-</span> rsample<span style="color:#f92672">::</span><span style="color:#a6e22e">testing</span>(splits)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">dim</span>(train_df)
</span></span><span style="display:flex;"><span><span style="color:#75715e">## [1] 354  23</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">dim</span>(test_df)
</span></span><span style="display:flex;"><span><span style="color:#75715e">## [1] 152  23</span>
</span></span></code></pre></div><h2 id="finding-optimal-parameters">Finding optimal parameters</h2>
<p>Now we can start to run some optimisations using the <code>ParBayesianOptimization</code> package.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># The xgboost interface accepts matrices </span>
</span></span><span style="display:flex;"><span>X <span style="color:#f92672">&lt;-</span> train_df <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Remove the target variable</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">select</span>(<span style="color:#f92672">!</span>medv, <span style="color:#f92672">!</span>cmedv) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">as.matrix</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get the target variable</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">&lt;-</span> train_df <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">pull</span>(cmedv)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Cross validation folds</span>
</span></span><span style="display:flex;"><span>folds <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(fold1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.integer</span>(<span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">nrow</span>(X), by <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>)),
</span></span><span style="display:flex;"><span>              fold2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.integer</span>(<span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">nrow</span>(X), by <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>)))
</span></span></code></pre></div><p>We&rsquo;ll need an objective function which can be fed to the optimiser. We&rsquo;ll use the value of the evaluation metric from <code>xgb.cv()</code> as the value that needs to be optimised.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Function must take the hyper-parameters as inputs</span>
</span></span><span style="display:flex;"><span>obj_func <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(eta, max_depth, min_child_weight, subsample, lambda, alpha) {
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  param <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Hyter parameters </span>
</span></span><span style="display:flex;"><span>    eta <span style="color:#f92672">=</span> eta,
</span></span><span style="display:flex;"><span>    max_depth <span style="color:#f92672">=</span> max_depth,
</span></span><span style="display:flex;"><span>    min_child_weight <span style="color:#f92672">=</span> min_child_weight,
</span></span><span style="display:flex;"><span>    subsample <span style="color:#f92672">=</span> subsample,
</span></span><span style="display:flex;"><span>    lambda <span style="color:#f92672">=</span> lambda,
</span></span><span style="display:flex;"><span>    alpha <span style="color:#f92672">=</span> alpha,
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Tree model </span>
</span></span><span style="display:flex;"><span>    booster <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gbtree&#34;</span>,
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Regression problem </span>
</span></span><span style="display:flex;"><span>    objective <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;reg:squarederror&#34;</span>,
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Use the Mean Absolute Percentage Error</span>
</span></span><span style="display:flex;"><span>    eval_metric <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mape&#34;</span>)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  xgbcv <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">xgb.cv</span>(params <span style="color:#f92672">=</span> param,
</span></span><span style="display:flex;"><span>                  data <span style="color:#f92672">=</span> X,
</span></span><span style="display:flex;"><span>                  label <span style="color:#f92672">=</span> y,
</span></span><span style="display:flex;"><span>                  nround <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>,
</span></span><span style="display:flex;"><span>                  folds <span style="color:#f92672">=</span> folds,
</span></span><span style="display:flex;"><span>                  prediction <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
</span></span><span style="display:flex;"><span>                  early_stopping_rounds <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>                  verbose <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                  maximize <span style="color:#f92672">=</span> F)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  lst <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># First argument must be named as &#34;Score&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Function finds maxima so inverting the output</span>
</span></span><span style="display:flex;"><span>    Score <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">min</span>(xgbcv<span style="color:#f92672">$</span>evaluation_log<span style="color:#f92672">$</span>test_mape_mean),
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get number of trees for the best performing model</span>
</span></span><span style="display:flex;"><span>    nrounds <span style="color:#f92672">=</span> xgbcv<span style="color:#f92672">$</span>best_iteration
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">return</span>(lst)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Once we have the objective function, we&rsquo;ll need to define some bounds for the optimiser to search within.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>bounds <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(eta <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.001</span>, <span style="color:#ae81ff">0.2</span>),
</span></span><span style="display:flex;"><span>               max_depth <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1L</span>, <span style="color:#ae81ff">10L</span>),
</span></span><span style="display:flex;"><span>               min_child_weight <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">50</span>),
</span></span><span style="display:flex;"><span>               subsample <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>               lambda <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>),
</span></span><span style="display:flex;"><span>               alpha <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>))
</span></span></code></pre></div><p>We can now run the optimiser to find a set of optimal hyper-parameters.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">1234</span>)
</span></span><span style="display:flex;"><span>bayes_out <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">bayesOpt</span>(FUN <span style="color:#f92672">=</span> obj_func, bounds <span style="color:#f92672">=</span> bounds, initPoints <span style="color:#f92672">=</span> <span style="color:#a6e22e">length</span>(bounds) <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>, iters.n <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Show relevant columns from the summary object </span>
</span></span><span style="display:flex;"><span>bayes_out<span style="color:#f92672">$</span>scoreSummary[1<span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">13</span>)]
</span></span><span style="display:flex;"><span><span style="color:#75715e">##           eta max_depth min_child_weight subsample   lambda    alpha      Score</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## 1: 0.13392137         8         4.913332 0.2105925 4.721124 3.887629 -0.0902970</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## 2: 0.19400811         2        25.454160 0.9594105 9.329695 3.173695 -0.1402720</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## 3: 0.16079775         2        14.035652 0.5118349 1.229953 5.093530 -0.1475580</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## 4: 0.08957707         4        12.534842 0.3844404 4.358837 1.788342 -0.1410245</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## 5: 0.02876388         4        36.586761 0.8107181 6.137100 6.039125 -0.3061535</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Get best parameters</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">data.frame</span>(<span style="color:#a6e22e">getBestPars</span>(bayes_out))
</span></span><span style="display:flex;"><span><span style="color:#75715e">##         eta max_depth min_child_weight subsample lambda alpha</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## 1 0.1905414         8         1.541476 0.8729207      1     1</span>
</span></span></code></pre></div><h2 id="fitting-the-model">Fitting the model</h2>
<p>We can now fit a model and check how well these parameters work.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Combine best params with base params</span>
</span></span><span style="display:flex;"><span>opt_params <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">list</span>(booster <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gbtree&#34;</span>, 
</span></span><span style="display:flex;"><span>                          objective <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;reg:squarederror&#34;</span>, 
</span></span><span style="display:flex;"><span>                          eval_metric <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mae&#34;</span>), 
</span></span><span style="display:flex;"><span>                     <span style="color:#a6e22e">getBestPars</span>(bayes_out))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run cross validation </span>
</span></span><span style="display:flex;"><span>xgbcv <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">xgb.cv</span>(params <span style="color:#f92672">=</span> opt_params,
</span></span><span style="display:flex;"><span>                data <span style="color:#f92672">=</span> X,
</span></span><span style="display:flex;"><span>                label <span style="color:#f92672">=</span> y,
</span></span><span style="display:flex;"><span>                nround <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>                folds <span style="color:#f92672">=</span> folds,
</span></span><span style="display:flex;"><span>                prediction <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
</span></span><span style="display:flex;"><span>                early_stopping_rounds <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>                verbose <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                maximize <span style="color:#f92672">=</span> F)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get optimal number of rounds</span>
</span></span><span style="display:flex;"><span>nrounds <span style="color:#f92672">=</span> xgbcv<span style="color:#f92672">$</span>best_iteration
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fit a xgb model</span>
</span></span><span style="display:flex;"><span>mdl <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">xgboost</span>(data <span style="color:#f92672">=</span> X, label <span style="color:#f92672">=</span> y, 
</span></span><span style="display:flex;"><span>               params <span style="color:#f92672">=</span> opt_params, 
</span></span><span style="display:flex;"><span>               maximize <span style="color:#f92672">=</span> F, 
</span></span><span style="display:flex;"><span>               early_stopping_rounds <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, 
</span></span><span style="display:flex;"><span>               nrounds <span style="color:#f92672">=</span> nrounds, 
</span></span><span style="display:flex;"><span>               verbose <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Evaluate performance </span>
</span></span><span style="display:flex;"><span>actuals <span style="color:#f92672">&lt;-</span> test_df<span style="color:#f92672">$</span>cmedv
</span></span><span style="display:flex;"><span>predicted <span style="color:#f92672">&lt;-</span> test_df <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">select_at</span>(mdl<span style="color:#f92672">$</span>feature_names) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  as.matrix <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">predict</span>(mdl, newdata <span style="color:#f92672">=</span> .)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Compute MAPE</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mean</span>(<span style="color:#a6e22e">abs</span>(actuals <span style="color:#f92672">-</span> predicted)<span style="color:#f92672">/</span>actuals)
</span></span><span style="display:flex;"><span><span style="color:#75715e">## [1] 0.009401109</span>
</span></span></code></pre></div><h2 id="compare-with-grid-search">Compare with grid search</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>grd <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">expand.grid</span>(
</span></span><span style="display:flex;"><span>  eta <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">0.001</span>, <span style="color:#ae81ff">0.2</span>, length.out <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>),
</span></span><span style="display:flex;"><span>  max_depth <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">2L</span>, <span style="color:#ae81ff">10L</span>, by <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>  min_child_weight <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">25</span>, length.out <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>),
</span></span><span style="display:flex;"><span>  subsample <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.75</span>, <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>  lambda <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">10</span>),
</span></span><span style="display:flex;"><span>  alpha <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dim</span>(grd)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>grd_out <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">apply</span>(grd, <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">function</span>(par){
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    par <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">append</span>(par, <span style="color:#a6e22e">list</span>(booster <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gbtree&#34;</span>,objective <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;reg:squarederror&#34;</span>,eval_metric <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mae&#34;</span>))
</span></span><span style="display:flex;"><span>    mdl <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">xgboost</span>(data <span style="color:#f92672">=</span> X, label <span style="color:#f92672">=</span> y, params <span style="color:#f92672">=</span> par, nrounds <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>, early_stopping_rounds <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, maximize <span style="color:#f92672">=</span> F, verbose <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    lst <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(par, score <span style="color:#f92672">=</span> mdl<span style="color:#f92672">$</span>best_score)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">return</span>(lst)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>grd_out <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">do.call</span>(rbind, grd_out)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>best_par <span style="color:#f92672">&lt;-</span> grd_out <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">data.frame</span>() <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">arrange</span>(score) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  .[1,]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Fit final model</span>
</span></span><span style="display:flex;"><span>params <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.list</span>(best_par[<span style="color:#f92672">-</span><span style="color:#a6e22e">length</span>(best_par)])
</span></span><span style="display:flex;"><span>xgbcv <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">xgb.cv</span>(params <span style="color:#f92672">=</span> params,
</span></span><span style="display:flex;"><span>                data <span style="color:#f92672">=</span> X,
</span></span><span style="display:flex;"><span>                label <span style="color:#f92672">=</span> y,
</span></span><span style="display:flex;"><span>                nround <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>                folds <span style="color:#f92672">=</span> folds,
</span></span><span style="display:flex;"><span>                prediction <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
</span></span><span style="display:flex;"><span>                early_stopping_rounds <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>                verbose <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                maximize <span style="color:#f92672">=</span> F)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nrounds <span style="color:#f92672">=</span> xgbcv<span style="color:#f92672">$</span>best_iteration
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mdl <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">xgboost</span>(data <span style="color:#f92672">=</span> X, 
</span></span><span style="display:flex;"><span>               label <span style="color:#f92672">=</span> y, 
</span></span><span style="display:flex;"><span>               params <span style="color:#f92672">=</span> params, 
</span></span><span style="display:flex;"><span>               maximize <span style="color:#f92672">=</span> F, 
</span></span><span style="display:flex;"><span>               early_stopping_rounds <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, 
</span></span><span style="display:flex;"><span>               nrounds <span style="color:#f92672">=</span> nrounds, 
</span></span><span style="display:flex;"><span>               verbose <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Evaluate on test set</span>
</span></span><span style="display:flex;"><span>act <span style="color:#f92672">&lt;-</span> test_df<span style="color:#f92672">$</span>medv
</span></span><span style="display:flex;"><span>pred <span style="color:#f92672">&lt;-</span> test_df <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">select_at</span>(mdl<span style="color:#f92672">$</span>feature_names) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  as.matrix <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">predict</span>(mdl, newdata <span style="color:#f92672">=</span> .)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">mean</span>(<span style="color:#a6e22e">abs</span>(act <span style="color:#f92672">-</span> pred)<span style="color:#f92672">/</span>act)
</span></span><span style="display:flex;"><span><span style="color:#75715e">## [1] 0.01581713</span>
</span></span></code></pre></div><p>While both the methods offer similar final results, the bayesian optimiser completed its search in less than a minute where as the grid search took over seven minutes. Also, I find that I can use bayesian optimisation to search a larger parameter space more quickly than a traditional grid search.</p>
<p><em>Thoughts? Comments? Helpful? Not helpful? Like to see anything else added in here? Let me know!</em></p>

      </article>
      

      
<div id="disqus_thread"></div>
<script>
var disqus_config = function () {
  this.page.url = "https://rtichoke.netlify.app/post/bayesian_optimisation_xgboost/";
  this.page.identifier = "f288edfdaa799c0d7ca579d369ecc723";
  this.page.title = "Using bayesian optimisation to tune a XGBOOST model in R";
};

(function() {
  window.setTimeout(function() {
    var d = document;
    var s = d.createElement('script');
    s.src = 'https://rtichoke.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    s.setAttribute("defer", "");
    d.body.appendChild(s);
  }, 2500);
})();
</script>

    </div>
  </div>
</div>

  </main>
  <footer class="footer">
  <div class="ax-l-i max-w-6xl">
    <nav class="flex items-center justify-center">
    </nav>
    <div class="footer-social flex items-center justify-center mt-4">
      <a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Twitter" href="https://twitter.com/r0yr2"><svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11 0 0 1-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56 0 0 0-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57 0 0 0 2.914 5.452 6.48 6.48 0 0 1-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42 0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57a13.18 13.18 0 0 1-8.134 2.798c-.538 0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072 0 18.672-10 18.672-18.668 0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg></a>
      <a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="GitHub" href="https://github.com/royr2"><svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M15.998 0C7.164 0 0 7.35 0 16.417 0 23.67 4.584 29.82 10.944 31.994c.8.15 1.092-.356 1.092-.79l-.022-2.792c-4.45.99-5.4-2.202-5.4-2.202-.726-1.896-1.776-2.4-1.776-2.4-1.454-1.018.108-.998.108-.998 1.606.117 2.45 1.693 2.45 1.693 1.428 2.507 3.746 1.784 4.658 1.363.144-1.06.558-1.784 1.016-2.195-3.552-.415-7.288-1.823-7.288-8.113 0-1.792.624-3.258 1.648-4.406-.166-.415-.714-2.085.156-4.344 0 0 1.344-.44 4.4 1.683 1.276-.364 2.644-.546 4.006-.552a14.98 14.98 0 0 1 4.006.554C23.062 6.37 24.404 6.8 24.404 6.8c.872 2.26.324 3.93.16 4.344 1.026 1.148 1.644 2.614 1.644 4.406 0 6.306-3.74 7.694-7.304 8.1.574.507 1.086 1.51 1.086 3.04l-.02 4.503c0 .44.288.95 1.1.788C27.42 29.817 32 23.667 32 16.417 32 7.35 24.836 0 15.998 0z"/></svg></a>
      <a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="LinkedIn" href="https://www.linkedin.com/in/riddhimanr"><svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M29.692 0H2.308A2.31 2.31 0 0 0 0 2.308v27.384A2.31 2.31 0 0 0 2.308 32h27.384A2.31 2.31 0 0 0 32 29.692V2.308A2.31 2.31 0 0 0 29.692 0zM11.35 24.188H7.454V12.464h3.897v11.723zM9.402 10.863h-.025c-1.308 0-2.153-.9-2.153-2.025 0-1.15.872-2.026 2.205-2.026s2.153.875 2.18 2.026c0 1.125-.846 2.025-2.205 2.025zm16 13.324h-3.896v-6.272c0-1.576-.564-2.65-1.974-2.65-1.076 0-1.717.725-2 1.425-.103.25-.128.6-.128.95v6.547h-3.896V12.464h3.896v1.66c.518-.8 1.444-1.935 3.512-1.935 2.564 0 4.486 1.676 4.486 5.276v6.722z"/></svg></a>
    </div>

    <div class="footer-copyright text-sm text-center text-gray-400 mt-4">
      &#169; 2023-2023 R&#39;tichoke
    </div>
    <div class="text-sm sm:text-xs text-center text-gray-400 mt-2">
      Powered by <a href="https://www.axiomtheme.com/?utm_source=theme-footer&utm_medium=website&utm_campaign=referral">Axiom</a>
    </div>
  </div>
</footer>

<script src="/bundle.js?v=1680150811"></script>


</body>
</html>
