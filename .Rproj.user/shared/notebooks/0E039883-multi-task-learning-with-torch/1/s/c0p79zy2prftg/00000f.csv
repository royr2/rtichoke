"0","#| label: feature-importance"
"0","#| fig-width: 10"
"0","#| fig-height: 6"
"0",""
"0","# Extract weights from the first shared layer"
"0","shared_weights <- as.matrix(model$shared_layer1$weight$detach())"
"0",""
"0","# Create feature importance visualization"
"0","feature_importance_df <- data.frame("
"0","  Feature = rep(paste0(""Feature_"", 1:5), each = 64),"
"0","  Neuron = rep(1:64, times = 5),"
"0","  Weight = as.vector(t(shared_weights))"
"0",")"
"0",""
"0","# Calculate average absolute importance per feature"
"0","feature_avg_importance <- feature_importance_df %>%"
"0","  group_by(Feature) %>%"
"0","  summarise("
"0","    Avg_Abs_Weight = mean(abs(Weight)),"
"0","    Std_Weight = sd(Weight)"
"0","  ) %>%"
"0","  arrange(desc(Avg_Abs_Weight))"
"0",""
"0","# Plot feature importance"
"0","p5 <- ggplot(feature_avg_importance, aes(x = reorder(Feature, Avg_Abs_Weight), "
"0","                                        y = Avg_Abs_Weight)) +"
"0","  geom_col(fill = ""#3498db"", alpha = 0.8) +"
"0","  geom_errorbar(aes(ymin = Avg_Abs_Weight - Std_Weight, "
"0","                    ymax = Avg_Abs_Weight + Std_Weight),"
"0","                width = 0.2, color = ""#2c3e50"") +"
"0","  coord_flip() +"
"0","  labs(title = ""Feature Importance in Shared Layers"","
"0","       subtitle = ""Average absolute weights from first shared layer"","
"0","       x = ""Features"", y = ""Average Absolute Weight"") +"
"0","  theme_minimal()"
"0",""
"0","# Weight distribution heatmap"
"0","p6 <- ggplot(feature_importance_df, aes(x = Neuron, y = Feature, fill = Weight)) +"
"0","  geom_tile() +"
"0","  scale_fill_gradient2(low = ""#e74c3c"", mid = ""white"", high = ""#2c3e50"", "
"0","                       midpoint = 0, name = ""Weight"") +"
"0","  labs(title = ""Shared Layer Weight Distribution"","
"0","       subtitle = ""How each feature connects to shared neurons"","
"0","       x = ""Neuron Index"", y = ""Input Features"") +"
"0","  theme_minimal() +"
"0","  theme(axis.text.x = element_blank())"
"0",""
"0","p5 | p6"
